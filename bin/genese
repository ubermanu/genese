#!/usr/bin/env php
<?php
if (file_exists(__DIR__ . '/../autoload.php')) {
    require_once __DIR__ . '/../autoload.php';
} elseif (file_exists(__DIR__ . '/../vendor/autoload.php')) {
    require_once __DIR__ . '/../vendor/autoload.php';
} elseif (file_exists(__DIR__ . '/../../../autoload.php')) {
    require_once __DIR__ . '/../../../autoload.php';
}

$app = new \Symfony\Component\Console\Application('genese');
$app->setVersion(\Composer\InstalledVersions::getRootPackage()['pretty_version']);
$app->add(new \Genese\Console\InitCommand());

try {
    $dotenv = new \Symfony\Component\Dotenv\Dotenv();
    $dotenv->loadEnv(getcwd() . '/.env');
} catch (\Symfony\Component\Dotenv\Exception\PathException $e) {
}

// The root dir for all the templates
$rootDir = getenv('GENESE_TEMPLATES') ?: '_templates';

// Generates a new command for the available generators
foreach (glob($rootDir . '/*/*') as $path) {
    $parts = explode(DIRECTORY_SEPARATOR, $path);
    $command = new \Genese\Console\GeneratorCommand($parts[1], $parts[2], $rootDir);
    $app->add($command);
}

$app->run();
